interface = node['pentest-env']['whonix']['interface']

execute "sed -i 's/.*#{interface}.*//g' /etc/network/interfaces"

include_recipe 'network_interfaces'

network_interfaces interface do
  gateway node['pentest-env']['whonix']['gateway']
  target node['pentest-env']['whonix']['address']
  mask node['pentest-env']['whonix']['netmask']
end

# TODO: Use the route resource
execute 'ip route del default '\
        "via #{node['pentest-env']['nat']['gateway']} "\
        "dev #{node['pentest-env']['nat']['interface']}"

execute 'ip route add default '\
        "via #{node['pentest-env']['whonix']['gateway']} "\
        "dev #{interface}"
